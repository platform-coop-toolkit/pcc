workflows:
  version: 2
  main:
    jobs:
      - assets-build
      - php73-build

version: 2

job-references:
  setup_environment: &setup_environment
    name: "Setup Environment Variables"
    command: |
      echo "export PATH=$HOME/.composer/vendor/bin:$PATH" >> $BASH_ENV
      source /home/circleci/.bashrc

  install_dependencies: &install_dependencies
  php_job: &php_job
    steps:
      - checkout
      - run: *setup_environment
      - run:
          name: "Run Tests"
          command: |
            composer install
            composer test

  assets_job: &assets_job
    steps:
      - checkout
      - run:
          name: "Run Tests"
          command: |
            yarn
            yarn test
            yarn build

jobs:
  assets-build:
    <<: *assets_job
    docker:
      - image: circleci/node:lts

  php73-build:
    <<: *php_job
    docker:
      - image: circleci/php:7.3
